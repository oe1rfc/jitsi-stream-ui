Vue.component('playerlink', {
  props: ['control'],
  data: function() {
    return {
      backgroundImage: "",
      css: "",
      displayName: "",
      id: "",
      xmpp_id: "",
      xmpp_password: "",
      advanced_view: false,
    }
  },
  computed: {
    link: function() {
        var linkurl = location.origin + location.pathname + "player.html#control=" + this.control;
        if (this.displayName != "")
            linkurl += `&displayName=${encodeURIComponent(this.displayName)}`;
        if (this.backgroundImage != "")
            linkurl += `&backgroundImage=${encodeURIComponent(this.backgroundImage)}`;
        if (this.css != "")
            linkurl += `&css=${encodeURIComponent(this.css)}`;
        if (this.advanced_view) {
            if (this.xmpp_id != "" && this.xmpp_password != "")
                linkurl += `&xmpp_id=${encodeURIComponent(this.xmpp_id)}&xmpp_password=${encodeURIComponent(this.xmpp_password)}`;
            if (this.id != "")
                linkurl += `&id=${encodeURIComponent(this.id)}`;
        }
        return linkurl;
    },
  },
  methods: {
    copy: function() {
        $("#playerlink_url").select();
        document.execCommand("copy");
    }
  },
  template: `
    <span>
        <button type="button" class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#playerlink-modal">Player Link</button>
        <div class="modal fade" id="playerlink-modal" tabindex="-1" aria-labelledby="joinModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add a Jitsi Player instance</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Control Room: <small>(this room)</small></label>
                            <input type="text" class="form-control" v-model="control" readonly />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Player Display Name: <small>(optional)</small></label>
                            <input type="text" class="form-control" v-model="displayName" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Background Image URL: <small>(optional)</small></label>
                            <input type="text" class="form-control" v-model="backgroundImage" placeholder="https://picsum.photos/1280/720" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Custom CSS URL: <small>(optional)</small></label>
                            <input type="text" class="form-control" v-model="css" placeholder="css/pw.css" />
                        </div>
                        <div class="form-check form-check-inline form-switch">
                            <input class="form-check-input" type="checkbox" v-model="advanced_view" />
                            <label class="form-check-label">advanced settings</label>
                        </div>
                        <div v-show="advanced_view">
                            <div class="mb-3">
                                <label class="form-label">XMPP Jibri Login: <small>(optional, server setup required)</small></label>
                                <input type="text" class="form-control" v-model="xmpp_id" placeholder="example@recorder.yourdomain.com" />
                                <input type="text" class="form-control" v-model="xmpp_password" placeholder="xmpp password" />
                            </div>
                            <div class="mb-3">
                                <label class="form-label">ID: <small>(optional, auto-generated by default)</small></label>
                                <input type="text" class="form-control" v-model="id" />
                                <div class="alert alert-warning" role="alert" v-show="id != ''">
                                    You have specified a custom player <b>id</b>, make sure
                                    this <b>id is unique</b> in this control room.
                                    <b>Only open this link once!</b>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="mb-3">
                            <label class="form-label">Jitsi Player Link: <small>(add this eg. as OBS Browser Source)</small></label>
                            <input type="text" class="form-control" v-model="link" id="playerlink_url" readonly onclick="this.select()"
                            style="font-size: 80%;" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary" v-on:click="copy" data-bs-dismiss="modal">copy link and close</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">close</button>
                    </div>
                </div>
            </div>
        </div>
    </template>
  `
});
